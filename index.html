<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link rel="stylesheet" href="./styles.css">
    <title>데이터시각화 테스트</title>
    <script
            type="text/javascript"
            src="https://www.gstatic.com/charts/loader.js"
    ></script>
    <script type="text/javascript">
        // 아래 두 줄은 google charts가 있는 모든 웹 페이지에 포함되어야 함
        // corechart (bar, column, line, area, stepped area, bubble, pie, donut, combo, candlestick, histogram, scatter)
        // drawChart 이름은 전역에서 정한 마음대로 사용할 수 있음
        google.charts.load("current", { packages: ["corechart"] });
        google.charts.setOnLoadCallback(drawChart);

        let data;
        let options;
        let chart;

        let mockData = [
            {
                country: "India",
                totalSales: 1000,
                percentage: 85,
                id: 0
            },
            {
                country: "Bangladesh",
                totalSales: 990,
                id: 1
            },                {
                country: "Pakistan",
                totalSales: 980,
                id: 2
            },
            {
                country: "Sri Lanka",
                totalSales: 900,
                id: 3
            },
            {
                country: "UAE",
                totalSales: 880,
                id: 4
            },
            {
                country: "Afghanistan",
                totalSales: 500,
                id: 5
            },
            {
                country: "Syria",
                totalSales: 450,
                id: 6
            },
            {
                country: "Iraq",
                totalSales: 400,
                id: 7
            },
            {
                country: "Armenia",
                totalSales: 390,
                id: 8
            },
            {
                country: "Palestine",
                totalSales: 380,
                id: 9
            },

        ]
        function drawChart() {
            // Define the chart to be drawn.
            data = new google.visualization.DataTable();
            data.addColumn('string', '국가명');
            data.addColumn('number', '매출액');

            data.addColumn({ 'role': 'annotation' });
            data.addColumn({ 'role': 'style' });
            data.addRows([
                ['India', 1000, '$1000' , '#133182'  ],
                ['Bangladesh', 800, '$800', '#1D4BC6'],
                ['Pakistan', 790, '$790', '#3B69E2'],
                ['Sri Lanka', 750, '$750', '#6F90EA'],
                ['UAE', 700, '$700', '#91ABEF'],
                [mockData[5].country, 680, '$680', '#C4D2F6'],
                ['Syria', 400, '$400', '#C4D2F6'],
                ['Iraq', 380, '$380', '#C4D2F6'],
                ['Armenia', 350, '$350', '#C4D2F6'],
                ['Palestine', 320, '$320', '#C4D2F6']
            ])
            options = {
                // 기본으로 제공되는 BAR 호버 & 액티브 기능 제거
                enableInteractivity: false,
                // 해당 바차트에서는 색상을 하나만 넣을 수 있음, 각자 넣으려면 컬럼에서 직접 넣는 방법이 있는데.. 위에서 스타일을 정하면 annotation 컬러 변경이 불가함
                // colors: ['pink'],
                legend: 'none',
                animation: {
                    startup: true,
                    duration: 200,
                    easing: 'inAndOut',
                },
                // tooptip.isHtml 옵션이 true여야 .google-visualization-tooltip으로  css 작업가능함
                // tooltip: { isHtml: true },
                annotations: {
                    alwaysOutside: true,
                    textStyle: {
                        // row 만들 때 이미 스타일을 줘버려서 annotation text color 적용이 안됨
                        color : '#424242',
                    }
                },
                tooltip: {
                    trigger: 'none'
                },
                bar: { groupWidth: 15 },



            };

            // Create and draw the visualization.
            chart = new google.visualization.BarChart(document.getElementById("bar-chart"));
            chart.draw(data, options);


                // let texts = document.querySelectorAll('text[text-anchor="start"]')
                // texts.forEach(text =>  {
                //     console.log('text test' ,text)
                //     text.setAttribute("class", "color")
                //
                // }
                // )




            // const onMouseOverHandler = () => {
            //     const bars = document.querySelectorAll('rect[x="162"]')
            //     bars.forEach(bar => bar.setAttribute("class", "country-bar"))
            //     console.log('1 test')
            // }
            //
            // google.visualization.events.addListener(chart, 'onmouseover', onMouseOverHandler);



        }
    </script>

    <script type="text/javascript">

        // 아래 두 줄은 google charts가 있는 모든 웹 페이지에 포함되어야 함
        // corechart (bar, column, line, area, stepped area, bubble, pie, donut, combo, candlestick, histogram, scatter)
        // drawChart 이름은 전역에서 정한 마음대로 사용할 수 있음
        google.charts.load("current", { packages: ["corechart"] });
        google.charts.setOnLoadCallback(drawChart);

        let data2;
        let options2;
        let chart2;

        function drawChart() {
            // Define the chart to be drawn.

            data2 = new google.visualization.DataTable();
            data2.addColumn('string', '국가명');
            data2.addColumn('number', '매출액');
            // options의 tooltip부분이 여기서 작동합니다
            data2.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});
            data2.addRows([
                ['India', 5000, customHTMLContent('India', 5000, 10000)],
                ['Bangladesh', 2000, customHTMLContent('Bangladesh', 2000, 10000)],
                ['Pakistan', 1000, customHTMLContent('Pakistan', 1000, 10000)],
                ['Sri Lanka', 500, customHTMLContent('Sri Lanka', 500, 10000)],
                ['UAE', 500, customHTMLContent('UAE', 500, 10000)],
                ['etc', 1000, customHTMLContent('etc', 1000, 10000)],
            ])


            options2 = {
                colors: ['#133182', '#1D4BC6', '#3B69E2', '#6F90EA', '#91ABEF', '#C4D2F6', '#C4D2F6', '#C4D2F6', '#C4D2F6', '#C4D2F6'],
                legend: 'none',
                // enableInteractivity: false,
                tooltip: { isHtml: true },
                annotations: {
                    alwaysOutside: true,
                    textStyle: {
                        // row 만들 때 이미 스타일을 줘버려서 annotation text color 적용이 안됨
                        color : '#fffff',
                    }
                }

            };

            // Instantiate and draw the chart.
            chart2 = new google.visualization.PieChart(document.querySelector("#pie-div"));
            chart2.draw(data2, options2);

            const texts = document.querySelectorAll('text[text-anchor="start"]')
            texts.forEach(text  => text.setAttribute("class", "percentage-text"))

            const onMouseOverHandler = () => {
                const pies = document.querySelectorAll('g')
                pies.forEach(pie => pie.setAttribute("class", "country-pie"))
            }


            google.visualization.events.addListener(chart2, 'onmouseover', onMouseOverHandler);
            // storyboard v4 tooltip contents 관련 코드입니다.
            function customHTMLContent(countryName, sales, total) {
                return `<strong class="test">${countryName}</strong>` + `<ul><li>$${sales} (${(sales/total*100)}%)</li><ul>`
            }

        }


    </script>
</head>
<body>
<h3>Sales by Country</h3>
<!-- Identify where the chart should be drawn. -->
<div>
    <div id="bar-chart" style="width: 900px; height: 500px;">
    </div>
</div>
<div id="pie-div" style="width: 900px; height: 500px;"></div>
<div>

</div>

</body>
</html>
